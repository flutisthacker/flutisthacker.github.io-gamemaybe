<html>

<head>
  <meta charset=" UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>change scale</title>
  <link rel="shortcut icon" href="https://www.transparentpng.com/thumb/musical-notes/music-notes-png-pictures-3.png"
    type="image/x-icon">
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"
    integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <link rel="stylesheet" href="../resources/perfect.css">
  <link rel="stylesheet" href="transposenote.css">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
</head>


<body>

  <div id="menu" class="menu">
    <div class="select">
      <ul id="songstwo">
      </ul>
    </div>
  </div>
  <div class="toggle" id="toggle">
    <i class="fa fa-folder-open"></i>
  </div>
  <div class="containerd">
    <div class="title">
      <h1 id="titlename">Transpose</h1>
    </div>
    <div class="addSect">
      <input type="text" id="notesearch" name="notesearch" placeholder="Enter your song name..." list="songsearch">
      <select name="" id="songs" hidden></select>
      <datalist id="songsearch">
      </datalist>

      <select name="" id="songkey">
        <option selected value="C">C</option>
        <option value="Cs">C#</option>
        <option value="D">D</option>
        <option value="Ds">D#</option>
        <option value="E">E</option>
        <option value="F">F</option>
        <option value="Fs">F#</option>
        <option value="G">G</option>
        <option value="Gs">G#</option>
        <option value="A">A</option>
        <option value="As">A#</option>
        <option value="B">B</option>
      </select>
      <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
        <i class="fa fa-camera"></i>
      </button>
      <button id="translate" class="add">translate</button>
      <button id="staff" class="add">staff</button>
    </div>
    <div class="list" id="capture"></div>
  </div>
  <div class="modal fade bd-example-modal-lg" id="exampleModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Capture</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body notecapture">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary">Save changes</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous">
  </script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous">
  </script>

  <script type="text/javascript" src="notes.json">
  </script>
  <script type="text/javascript" src="varnotes.js">
  </script>
  <script type="text/javascript" src="varnotes2.js">
  </script>
  <script>
    // notex = notex + raagnotes;

    var btn = document.getElementById("toggle");
    var menu = document.getElementById("menu");
    btn.addEventListener("click", toggleMenu)
    menu.addEventListener("click", toggleMenu)

    function toggleMenu() {
      if (menu.classList.contains('open')) {
        menu.classList.remove('open')
      } else {
        menu.classList.add('open')

      }
    }
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="../../htmltocanvas.min.js"></script>
  <script>
    document.addEventListener("keyup", (e) => {
      if (e.keyCode == 67 && e.keyCode == 16) {
        console.log(e.key, songs.value)
        html2canvas(document.querySelector("#capture")).then(canvas => {
          document.body.appendChild(canvas)
          // $('.modal-body').append(canvas)
          // $('#exampleModal').modal()
        });
      }
    })
    document.querySelector(".btn-primary").addEventListener("click", () => {
      html2canvas(document.querySelector("#capture")).then(canvas => {
        $('.notecapture').append(canvas)
      });
    })
    // console.log(mydata[0].age);
    // console.log(mydata[1].name);
    // console.log(mydata[1].age);

    document.querySelector("#staff").addEventListener("click", (e) => {
      a = eval(songs.value)
      console.log(songs.value, a)
      totransposed = {
        name: songs.value,
        notes: eval(songs.value)
      }
      let cccc = JSON.stringify(totransposed)
      localStorage.setItem("totranslatenote", cccc);
      location.href = "transpose4.html"
    });
  </script>

  <script>
    abcd = "c#d#f#"
    console.log(splitnotes(abcd));

    function splitnotes(abcd) {
      defg = [];
      bcde = abcd.split("")
      bcde.forEach((cdef, index) => {
        if (cdef.includes("#")) {
          defg.push(index)

        }
      })

      for (j = 0; j < bcde.length; j++) {
        for (i = 0; i < defg.length; i++) {
          if (j == defg[i]) {
            bcde[j - 1] = bcde[j - 1] + bcde[defg[i]]
          }
        }
      }

      w = 0;
      for (i = 0; i < defg.length; i++) {
        bcde.splice(defg[i] - w, 1)
        w++;
      }
      return bcde.join().split(",");
      // return bcde.join().split(", ,");
    }
  </script>

  <script>
    const Ckey = ["c", "c#", "d", "d#", "e", "f", "f#", "g", "g#", "a", "a#", "b", "-"];
    const Nepnotes = ["सा", "रेे।", "रे", "ग|", "ग", "म", "म।", "प", "ध।", "ध", "नि।", "नि", "-"];
    const Newanotes = ["न", "माे।", "माे", "बा।", "बा।", "गे", "म।", "साे", "ध।", "रा", "नि।", "क", "-"];
    const solfege = ["do", "re।", "re", "mi।", "mi", "fa", "so।", "so", "la।", "la", "ti।", "ti", "-"];
    const Cskey = ["c#", "d", "d#", "e", "f", "f#", "g", "g#", "a", "a#", "b", "c", "-"];
    const Dkey = ["d", "d#", "e", "f", "f#", "g", "g#", "a", "a#", "b", "c", "c#", "-"];
    const Dskey = ["d#", "e", "f", "f#", "g", "g#", "a", "a#", "b", "c", "c#", "d", "-"];
    const Ekey = ["e", "f", "f#", "g", "g#", "a", "a#", "b", "c", "c#", "d", "d#", "-"];
    const Fkey = ["f", "f#", "g", "g#", "a", "a#", "b", "c", "c#", "d", "d#", "e", "-"];
    const Fskey = ["f#", "g", "g#", "a", "a#", "b", "c", "c#", "d", "d#", "e", "f", "-"];
    const Gkey = ["g", "g#", "a", "a#", "b", "c", "c#", "d", "d#", "e", "f", "f#", "-"];
    const Gskey = ["g#", "a", "a#", "b", "c", "c#", "d", "d#", "e", "f", "f#", "g", "-"];
    const Akey = ["a", "a#", "b", "c", "c#", "d", "d#", "e", "f", "f#", "g", "g#", "-"];
    const Askey = ["a#", "b", "c", "c#", "d", "d#", "e", "f", "f#", "g", "g#", "a", "-"];
    const Bkey = ["b", "c", "c#", "d", "d#", "e", "f", "f#", "g", "g#", "a", "a#", "-"];

    songs = document.querySelector("#songs");
    songstwoli = document.querySelectorAll("#songstwo li");
    songkey = document.querySelector("#songkey");
    translate = document.querySelector("#translate");
    // Ckey.map(key => console.log(`${key} is the natural key`))
    var cursongtwo = "";
    translate.addEventListener("click", () => {
      // translates(eval(songs.value))
      // translates(totranspose, 8)
      transpose(totranspose, eval("Nepnotes"), 8)
    });
    songstwoli.forEach(songl => {
      songl.addEventListener("click", (e) => {
        songlid = songl.id
        document.querySelector("#titlename").innerHTML = songlid
        songlid2 = songlid
        // alert("herum" + eval(songlid2.replace('.note', '.beat')), songlid);
        songlid.replace("note.", "")
        if (cursongtwo == "") {
          cursongtwo = songlid;
        } else {
          document.getElementById(cursongtwo).className = "";
          cursongtwo = songlid;
        }
        songl.className = "active"
        // alert("herum" + eval(songlid2.replace('.note', '.key')));
        transpose(eval(songlid), eval(songkey.value + "key"), eval(songlid.replace(".note", ".beat")))
      });
    })
    document.querySelector("#notesearch").addEventListener("keyup", (e) => {
      noteserchval = document.querySelector("#notesearch").value;
      notesearched = noteserchval.replaceAll(" ", "")
      transpose(eval("notex." + notesearched + ".note"), eval(songkey.value + "key"), eval("notex." + notesearched +
        ".beat"))
    })
    songs.addEventListener("change", () => {
      // a = song.value;
      // alert("herum" + a.replace('.note', '.key'));
      document.querySelector("#titlename").innerHTML = (songs.value).replace(".note", "")
      // songkey.value=""
      transpose(eval(songs.value), eval(songkey.value + "key"), eval((songs.value).replace(".note", ".beat")))
    });
    songkey.addEventListener("change", () => {
      document.querySelector("#titlename").innerHTML = songs.value
      transpose(eval(songs.value), eval(songkey.value + "key"), eval((songs.value).replace(".note", ".beat")))
    });

    var totranspose = [];

    function transpose(note, key, beat) {
      console.log("html", note, key)

      newscale = [];
      for (i = 0; i < note.length; i++) {
        if (note[i].length >= 2 && note[i].length < 9) {
          // if (note[i].length == 2 || note[i].length == 3 || note[i].length == 4 || note[i].length == 5) {
          notej = [];
          let notei;
          if (note[i].includes("#")) {
            notei = splitnotes(note[i])
          } else {
            notei = note[i].split("")
          }
          console.log("notei:" + notei, note[i])
          for (z = 0; z < notei.length; z++) {
            // notei = breakdown of "cdef" to "c","d"
            Ckey.forEach((ckey, index) => {
              //def=> converted to d#ff# if key cskey
              if (notei[z].toLowerCase() == ckey) {
                // console.log(Ckey[x], notei[z], key[x])
                notej.push(key[index])
              }
            })
          }
          // console.log("my length" + note[i].length, note[i]);
          // console.log(notej + "conjoined piece")
          const searchRegExp = /,/g;
          const replaceWith = '';
          const result = notej.join().replace(searchRegExp, replaceWith);
          // console.log(result)
          newscale.push(result);

        } else {
          // onee transpose C=>D
          Ckey.forEach((ckey, index) => {
            if (note[i].toLowerCase() == ckey) {
              // console.log(note[i].toLowerCase(), i, Ckey[j], j)
              // console.log(key[j], newscale)
              newscale.push(key[index]);
            }
          })
        }
      }
      totranspose = newscale;
      maketable(beat);
      tabledisplay(newscale, beat);
      return newscale;
    }

    function tabledisplay(na, beat) {
      console.log("html");

      // maketable();
      count = 0;
      tbody = document.querySelector('.tbody');
      let tr;
      for (i = 0; i < na.length; i++) {
        if (i % beat == 0) {
          tr = document.createElement('tr');
        }
        let td = document.createElement('td');
        td.innerHTML = na[i];
        tr.appendChild(td);
        tbody.appendChild(tr);
      }
    }

    function maketable(numoftab) {
      console.log("html", numoftab)

      body = document.querySelector('.list');
      body.innerHTML = ""
      table = document.createElement('table');
      table.className = "table table-hover"
      thead = document.createElement('thead');
      thead.className = "thead bg-dark text-light"
      tbody = document.createElement('tbody');
      tbody.className = "tbody"
      theadtr = document.createElement('tr');
      var tds = [];
      for (var i = 0; i < numoftab; i++) {
        tds[i] = document.createElement("td");
        tds[i].innerHTML = i + 1;
      }
      table.prepend(tbody)
      for (var i = (numoftab - 1); i >= 0; i--) {
        theadtr.prepend(tds[i])
      }
      thead.prepend(theadtr)
      table.prepend(thead)
      body.prepend(table)
    }


    // to delete
    function translates(note, beat) {
      // to nepali
      console.log("html")
      let newscale = [];
      for (i = 0; i < note.length; i++) {
        if ((note[i].length == 2 || note[i].length == 3 || note[i].length == 4)) {
          notej = [];
          if (note[i].length >= 2 && note[i].includes("#")) {
            notei = splitnotes(note[i])
          } else {
            notei = note[i].split("")
          }
          // console.log(notei, note[i])
          for (let z = 0; z < notei.length; z++) {
            for (let x = 0; x < Ckey.length; x++) {
              if (notei[z] == Ckey[x]) {
                // console.log(Ckey[x], notei[z], Nepnotes[x])
                notej.push(Nepnotes[x])
              }
            }
          }
          console.log("my length" + note[i].length, note[i]);

          console.log(notej)
          const searchRegExp = /,/g;
          const replaceWith = '';
          const result = notej.join().replace(searchRegExp, replaceWith);
          newscale.push(result);
        }
        //
        //         if ((note[i].length == 2 || note[i].length == 3 || note[i].length == 4) && note[i].includes("#")) {
        //           notej = [];
        //           let splitednotes = splitnotes(note[i]);


        //           for (let z = 0; z < splitednotes.length; z++) {
        //             for (let x = 0; x < Ckey.length; x++) {
        //               debugger
        //               if (splitednotes[z] == Ckey[x]) {
        //                 console.log(Ckey[x], splitednotes[z], Nepnotes[x])
        //                 notej.push(Nepnotes[x])
        //               }
        //             }
        //           }
        //           console.log(notej)
        //         }
        //
        else {
          for (j = 0; j < Nepnotes.length; j++) {
            if (note[i] == Ckey[j]) {
              // console.log(note[i], Nepnotes[j])
              newscale.push(Nepnotes[j]);
            }
          }
        }
      }
      // hello
      maketable(beat);
      tabledisplay(newscale, beat);
      // return newscale;
    }
  </script>
</body>

</html>
