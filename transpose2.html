<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>change scale</title>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"
    integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <link rel="stylesheet" href="transposenote.css">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
</head>

<body>

  <div class="containerd">
    <div class="title">
      <h1 id="titlename">Transpose</h1>
    </div>
    <div class="addSect">
      <select name="" id="songs">
      </select>
      <select name="" id="songkey">
        <option selected value="C">C</option>
        <option value="Cs">C#</option>
        <option value="D">D</option>
        <option value="Ds">D#</option>
        <option value="E">E</option>
        <option value="F">F</option>
        <option value="Fs">F#</option>
        <option value="G">G</option>
        <option value="Gs">G#</option>
        <option value="A">A</option>
        <option value="As">A#</option>
        <option value="B">B</option>
      </select>
      <button id="translate" class="add">translate</button>
    </div>
    <div class="list"></div>
  </div>

  <script type="text/javascript" src="notes.json">
  </script>
  <script type="text/javascript" src="varnotes.js">
  </script>

  <script>
    // console.log(mydata[0].age);
    // console.log(mydata[1].name);
    // console.log(mydata[1].age);
    /* function readTextFile(file, callback) {
      var rawFile = new XMLHttpRequest();
      rawFile.overrideMimeType("application/json");
      rawFile.open("GET", file, true);
      rawFile.onreadystatechange = function () {
        if (rawFile.readyState === 4 && rawFile.status == "200") {
          callback(rawFile.responseText);
        }
      }
      rawFile.send(null);
    }

    //usage:
    readTextFile("/Users/Documents/workspace/test.json", function (text) {
      var data = JSON.parse(text);
      console.log(data);
    }); */

    /*     fetch("notes.json")
      .then(response => response.json())
      .then(json => console.log(json)); */

    /* <input type="file" id="get_the_file">
    document.getElementById("get_the_file").addEventListener("change", function() {
      var file_to_read = document.getElementById("get_the_file").files[0];
      var fileread = new FileReader();
      fileread.onload = function(e) {
        var content = e.target.result;
        // console.log(content);
        var intern = JSON.parse(content); // Array of Objects.
        console.log(intern); // You can index every object
      };
      fileread.readAsText(file_to_read);
    }); */
  </script>
  <script>
    const Ckey = ["c", "c#", "d", "d#", "e", "f", "f#", "g", "g#", "a", "a#", "b", "-"];
    const Nepnotes = ["सा", "रेे।", "रे", "ग|", "ग", "म", "म।", "प", "ध।", "ध", "नि।", "नि", "-"];
    const Cskey = ["c#", "d", "d#", "e", "f", "f#", "g", "g#", "a", "a#", "b", "c", "-"];
    const Dkey = ["d", "d#", "e", "f", "f#", "g", "g#", "a", "a#", "b", "c", "c#", "-"];
    const Dskey = ["d#", "e", "f", "f#", "g", "g#", "a", "a#", "b", "c", "c#", "d", "-"];
    const Ekey = ["e", "f", "f#", "g", "g#", "a", "a#", "b", "c", "c#", "d", "d#", "-"];
    const Fkey = ["f", "f#", "g", "g#", "a", "a#", "b", "c", "c#", "d", "d#", "e", "-"];
    const Fskey = ["f#", "g", "g#", "a", "a#", "b", "c", "c#", "d", "d#", "e", "f", "-"];
    const Gkey = ["g", "g#", "a", "a#", "b", "c", "c#", "d", "d#", "e", "f", "f#", "-"];
    const Gskey = ["g#", "a", "a#", "b", "c", "c#", "d", "d#", "e", "f", "f#", "g", "-"];
    const Akey = ["a", "a#", "b", "c", "c#", "d", "d#", "e", "f", "f#", "g", "g#", "-"];
    const Askey = ["a#", "b", "c", "c#", "d", "d#", "e", "f", "f#", "g", "g#", "a", "-"];
    const Bkey = ["b", "c", "c#", "d", "d#", "e", "f", "f#", "g", "g#", "a", "a#", "-"];

    songs = document.querySelector("#songs");
    songkey = document.querySelector("#songkey");
    translate = document.querySelector("#translate");
    // Ckey.map(key => console.log(`${key} is the natural key`))

    translate.addEventListener("click", () => {
      // translates(eval(songs.value))
      translates(totranspose)
    });
    songs.addEventListener("change", () => {
      transpose(eval(songs.value), eval(songkey.value + "key"))
    });
    songkey.addEventListener("change", () => {
      transpose(eval(songs.value), eval(songkey.value + "key"))
    });

    var totranspose = [];

    function translates(note) {
      // to nepali
      let newscale = [];
      for (i = 0; i < note.length; i++) {
        if ((note[i].length == 2 || note[i].length == 3 || note[i].length == 4) && !note[i].includes("#")) {
          notej = [];
          notei = note[i].split("")
          console.log(notei, note[i])
          for (z = 0; z < notei.length; z++) {
            for (x = 0; x < Ckey.length; x++) {
              if (notei[z] == Ckey[x]) {
                console.log(Ckey[x], notei[z], Nepnotes[x])
                notej.push(Nepnotes[x])
              }
            }
          }
          console.log("my length" + note[i].length, note[i]);

          console.log(notej)
          const searchRegExp = /,/g;
          const replaceWith = '';
          const result = notej.join().replace(searchRegExp, replaceWith);
          newscale.push(result);
        }

        for (j = 0; j < Nepnotes.length; j++) {
          if (note[i] == Ckey[j]) {
            console.log(note[i], Nepnotes[j])
            newscale.push(Nepnotes[j]);
          }
        }
      }
      // hello
      tabledisplay(newscale);
      // return newscale;
    }

    function transpose(note, key) {
      newscale = [];
      for (i = 0; i < note.length; i++) {
        if (note[i].length == 2 || note[i].length == 3 || note[i].length == 4) {
          notej = [];
          notei = note[i].split("")
          // console.log(notei, note[i])
          for (z = 0; z < notei.length; z++) {
            for (x = 0; x < Ckey.length; x++) {
              if (notei[z] == Ckey[x]) {
                // console.log(Ckey[x], notei[z], key[x])
                notej.push(key[x])
              }
            }
          }
          // console.log("my length" + note[i].length, note[i]);
          // console.log(notej + "conjoined piece")
          const searchRegExp = /,/g;
          const replaceWith = '';
          const result = notej.join().replace(searchRegExp, replaceWith);
          newscale.push(result);

        }
        for (j = 0; j < Ckey.length; j++) {
          if (note[i] == Ckey[j]) {
            newscale.push(key[j]);
          }
        }
      }
      totranspose = newscale;
      tabledisplay(newscale);
      return newscale;
    }

    function tabledisplay(na) {
      maketable();
      count = 0;
      tbody = document.querySelector('.tbody');
      for (i = 0; i < na.length; i++) {
        if (i % 8 == 0) {
          tr = document.createElement('tr');
        }
        td = document.createElement('td');
        td.innerHTML = na[i];
        tr.appendChild(td);
        tbody.appendChild(tr);
      }
    }

    function maketable() {
      body = document.querySelector('.list');
      body.innerHTML = ""
      table = document.createElement('table');
      table.className = "table table-hover"
      thead = document.createElement('thead');
      thead.className = "thead bg-dark text-light"
      tbody = document.createElement('tbody');
      tbody.className = "tbody"
      theadtr = document.createElement('tr');
      td1 = document.createElement('td');
      td1.innerHTML = "1";
      td2 = document.createElement('td');
      td2.innerHTML = "2";
      td3 = document.createElement('td');
      td3.innerHTML = "3";
      td4 = document.createElement('td');
      td4.innerHTML = "4";
      td5 = document.createElement('td');
      td5.innerHTML = "5";
      td6 = document.createElement('td');
      td6.innerHTML = "6";
      td7 = document.createElement('td');
      td7.innerHTML = "7";
      td8 = document.createElement('td');
      td8.innerHTML = "8";
      table.prepend(tbody)
      theadtr.prepend(td8)
      theadtr.prepend(td7)
      theadtr.prepend(td6)
      theadtr.prepend(td5)
      theadtr.prepend(td4)
      theadtr.prepend(td3)
      theadtr.prepend(td2)
      theadtr.prepend(td1)
      thead.prepend(theadtr)
      table.prepend(thead)
      body.prepend(table)

    }
  </script>
</body>

</html>
